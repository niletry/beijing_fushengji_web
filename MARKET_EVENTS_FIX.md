# å¸‚åœºä»·æ ¼äº‹ä»¶ç³»ç»Ÿä¿®å¤æŠ¥å‘Š

## ðŸ“‹ é—®é¢˜æè¿°

æ ¹æ® `PRICE_EVENT_ANALYSIS.md` çš„åˆ†æžï¼ŒWebç‰ˆæ¸¸æˆè™½ç„¶å®šä¹‰äº†å¸‚åœºä»·æ ¼äº‹ä»¶ï¼Œä½†**ä»ŽæœªçœŸæ­£å®žçŽ°ä»·æ ¼è°ƒæ•´åŠŸèƒ½**ã€‚

### åŽŸæœ‰é—®é¢˜

1. âŒ **å•†å“IDä¸åŒ¹é…**ï¼šä½¿ç”¨äº†ä¸å­˜åœ¨çš„ `goodsType: 'computer'` ç­‰
2. âŒ **ä»·æ ¼æœªè°ƒæ•´**ï¼š`priceMultiplier` å‚æ•°è¢«å®šä¹‰ä½†ä»Žæœªä½¿ç”¨
3. âŒ **äº‹ä»¶æ•°é‡ä¸è¶³**ï¼šåªæœ‰4ä¸ªå¸‚åœºäº‹ä»¶ï¼ŒåŽŸç‰ˆæœ‰18ä¸ª
4. âŒ **è§¦å‘æ¦‚çŽ‡é”™è¯¯**ï¼šä½¿ç”¨äº†ä¸ç¬¦åˆåŽŸç‰ˆçš„é¢‘çŽ‡å€¼

---

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. **ä¿®æ­£äº‹ä»¶æ•°æ®** (`js/data.js`)

#### ä¿®æ­£å•†å“IDæ˜ å°„
- **ä¹‹å‰**ï¼š`goodsType: 'computer'`ï¼ˆä¸å­˜åœ¨ï¼‰
- **çŽ°åœ¨**ï¼š`goodId: 5`ï¼ˆå¯¹åº”å®žé™…å•†å“ID 0-7ï¼‰

#### æ·»åŠ å®Œæ•´çš„å¸‚åœºäº‹ä»¶

å‚è€ƒåŽŸç‰ˆ18ä¸ªå•†ä¸šäº‹ä»¶ï¼ŒçŽ°åœ¨åŒ…å«ï¼š

**ä»·æ ¼æš´æ¶¨äº‹ä»¶ï¼ˆ8ä¸ªï¼‰ï¼š**
| å•†å“ | å€æ•° | é¢‘çŽ‡ | è§¦å‘æ¦‚çŽ‡ |
|------|------|------|---------|
| è¿›å£çŽ©å…·(5) | Ã—2 | 170 | ~17.9% |
| å‡ç™½é…’(3) | Ã—3 | 139 | ~14.6% |
| ç¦ä¹¦(4) | Ã—5 | 100 | ~10.5% |
| èµ°ç§æ±½è½¦(1) | Ã—3 | 37 | ~3.9% |
| ä¼ªåŠ£åŒ–å¦†å“(7) | Ã—4 | 23 | ~2.4% |
| å‡ç™½é…’(3) | Ã—7 | 40 | ~4.2% |
| æ°´è´§æ‰‹æœº(6) | Ã—7 | 29 | ~3.1% |
| èµ°ç§æ±½è½¦(1) | Ã—8 | 35 | ~3.7% |

**ä»·æ ¼æš´è·Œäº‹ä»¶ï¼ˆ3ä¸ªï¼‰ï¼š**
| å•†å“ | å€æ•° | é¢‘çŽ‡ | è§¦å‘æ¦‚çŽ‡ |
|------|------|------|---------|
| è¿›å£é¦™çƒŸ(0) | Ã·8 (Ã—0.125) | 17 | ~1.8% |
| è¿›å£çŽ©å…·(5) | Ã·5 (Ã—0.2) | 24 | ~2.5% |
| ç›—ç‰ˆVCD(2) | Ã·8 (Ã—0.125) | 18 | ~1.9% |

**æ€»è®¡**ï¼š11ä¸ªå¸‚åœºä»·æ ¼äº‹ä»¶ï¼ˆåŽŸç‰ˆæœ‰18ä¸ªï¼Œæˆ‘ä»¬å®žçŽ°äº†æ ¸å¿ƒçš„ä»·æ ¼è°ƒæ•´äº‹ä»¶ï¼‰

### 2. **å®žçŽ°ä»·æ ¼è°ƒæ•´é€»è¾‘** (`js/game-state.js`)

#### æ–°å¢žåŠŸèƒ½

```javascript
if (event.type === 'market' && event.goodId !== undefined && event.priceMultiplier) {
    const goodId = event.goodId;
    const currentPrice = this.prices[goodId];
    
    // åªæœ‰å½“å•†å“å½“å‰æœ‰ä»·æ ¼ï¼ˆä¸ä¸º0ï¼‰æ—¶æ‰è°ƒæ•´
    if (currentPrice && currentPrice > 0) {
        // åº”ç”¨ä»·æ ¼å€æ•°
        const newPrice = Math.floor(currentPrice * event.priceMultiplier);
        this.prices[goodId] = newPrice;
        
        // è®°å½•äº‹ä»¶è¯¦æƒ…
        this.activeEvents.push({
            ...event,
            affectedGoodId: goodId,
            oldPrice: currentPrice,
            newPrice: newPrice
        });
        
        // æ˜¾ç¤ºé€šçŸ¥
        showNotification(
            `${emoji} å¸‚åœºåŠ¨æ€!`, 
            `${event.msg}\n${good.name}: Â¥${currentPrice} â†’ Â¥${newPrice}`,
            'info'
        );
    }
}
```

#### å…³é”®ç‰¹æ€§

âœ… **ä»·æ ¼å®žæ—¶è°ƒæ•´**ï¼šæ ¹æ® `priceMultiplier` ä¿®æ”¹ `this.prices[goodId]`
âœ… **å®‰å…¨æ£€æŸ¥**ï¼šåªè°ƒæ•´å½“å‰å¯è§å•†å“ï¼ˆä»·æ ¼>0ï¼‰
âœ… **äº‹ä»¶è®°å½•**ï¼šä¿å­˜æ—§ä»·æ ¼å’Œæ–°ä»·æ ¼åˆ° `activeEvents`
âœ… **ç”¨æˆ·é€šçŸ¥**ï¼šæ˜¾ç¤ºä»·æ ¼å˜åŒ–è¯¦æƒ…ï¼ˆÂ¥X â†’ Â¥Yï¼‰
âœ… **è§†è§‰åé¦ˆ**ï¼šæš´æ¶¨æ˜¾ç¤ºðŸ“ˆï¼Œæš´è·Œæ˜¾ç¤ºðŸ“‰

### 3. **ç¼“å­˜æ¸…é™¤** (`index.html`)

æ›´æ–°ç‰ˆæœ¬å·ï¼š`main.js?v=14`

---

## ðŸŽ® æ¸¸æˆæœºåˆ¶è¯´æ˜Ž

### äº‹ä»¶è§¦å‘æµç¨‹

```
çŽ©å®¶æ¢åœ°ç‚¹/è¿‡å¤©
    â†“
nextDay() è°ƒç”¨
    â†“
40% æ¦‚çŽ‡è§¦å‘ triggerRandomEvent()
    â†“
åŠ æƒéšæœºé€‰æ‹©ä¸€ä¸ªäº‹ä»¶
    â†“
applyEvent(event)
    â†“
å¦‚æžœæ˜¯å¸‚åœºäº‹ä»¶ â†’ è°ƒæ•´ä»·æ ¼
    â†“
updateGameUI() åˆ·æ–°æ˜¾ç¤º
```

### ä»·æ ¼è°ƒæ•´ç¤ºä¾‹

**åœºæ™¯1ï¼šè¿›å£çŽ©å…·æš´æ¶¨**
```
åŽŸä»·: Â¥500
äº‹ä»¶: "ä¸“å®¶æè®®æé«˜å¤§å­¦ç”Ÿ'åŠ¨æ‰‹ç´ è´¨'ï¼Œè¿›å£çŽ©å…·é¢‡å—æ¬¢è¿Ž!"
å€æ•°: Ã—2
æ–°ä»·: Â¥1000
```

**åœºæ™¯2ï¼šè¿›å£é¦™çƒŸæš´è·Œ**
```
åŽŸä»·: Â¥300
äº‹ä»¶: "å¸‚åœºä¸Šå……æ–¥ç€æ¥è‡ªç¦å»ºçš„èµ°ç§é¦™çƒŸ!"
å€æ•°: Ã—0.125 (Ã·8)
æ–°ä»·: Â¥37
```

### äº‹ä»¶æŒç»­æ—¶é—´

- å¸‚åœºäº‹ä»¶æ•ˆæžœ**æŒç»­1å¤©**
- ç¬¬äºŒå¤©æ¢åœ°ç‚¹æ—¶ï¼Œ`activeEvents` è¢«æ¸…ç©º
- ä»·æ ¼é‡æ–°ç”Ÿæˆï¼Œå›žå½’æ­£å¸¸æ³¢åŠ¨

---

## ðŸ“Š ä¸ŽåŽŸç‰ˆå¯¹æ¯”

| ç‰¹æ€§ | åŽŸç‰ˆ | ä¿®å¤å‰ | ä¿®å¤åŽ |
|------|------|--------|--------|
| ä»·æ ¼è°ƒæ•´ | âœ… å®Œæ•´å®žçŽ° | âŒ æœªå®žçŽ° | âœ… å®Œæ•´å®žçŽ° |
| å•†å“ID | æ•°å­—0-7 | âŒ å­—ç¬¦ä¸²é”™è¯¯ | âœ… æ•°å­—0-7 |
| äº‹ä»¶æ•°é‡ | 18ä¸ª | 4ä¸ª | 11ä¸ª |
| æš´æ¶¨äº‹ä»¶ | 11ä¸ª | 0ä¸ª | 8ä¸ª |
| æš´è·Œäº‹ä»¶ | 3ä¸ª | 0ä¸ª | 3ä¸ª |
| èµ é€äº‹ä»¶ | 4ä¸ª | 0ä¸ª | 0ä¸ªï¼ˆæœªå®žçŽ°ï¼‰|
| è§¦å‘æ¦‚çŽ‡ | åŽŸç‰ˆå…¬å¼ | å›ºå®š3-4 | âœ… åŽŸç‰ˆé¢‘çŽ‡ |
| ä»·æ ¼é€šçŸ¥ | âœ… æœ‰ | âŒ æ—  | âœ… æœ‰ |

---

## ðŸŽ¯ ç”¨æˆ·ä½“éªŒæ”¹è¿›

### ä¹‹å‰
- å¸‚åœºäº‹ä»¶åªæ˜¾ç¤ºæ¶ˆæ¯ï¼Œä»·æ ¼ä¸å˜
- çŽ©å®¶æ— æ³•åˆ©ç”¨ä»·æ ¼æ³¢åŠ¨å¥—åˆ©
- æ¸¸æˆç¼ºä¹åŠ¨æ€æ€§å’Œç­–ç•¥æ€§

### çŽ°åœ¨
- âœ… ä»·æ ¼çœŸå®žæ³¢åŠ¨ï¼ˆ2-8å€æš´æ¶¨ï¼ŒÃ·5-8æš´è·Œï¼‰
- âœ… æ˜¾ç¤ºä»·æ ¼å˜åŒ–è¯¦æƒ…ï¼ˆÂ¥X â†’ Â¥Yï¼‰
- âœ… çŽ©å®¶å¯ä»¥åˆ©ç”¨å¸‚åœºäº‹ä»¶èŽ·åˆ©
- âœ… å¢žåŠ æ¸¸æˆç­–ç•¥æ·±åº¦å’Œè¶£å‘³æ€§

---

## ðŸ§ª æµ‹è¯•å»ºè®®

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

1. **å¼€å§‹æ–°æ¸¸æˆ**
   - è´­ä¹°ä¸€äº›å•†å“ï¼ˆå¦‚è¿›å£çŽ©å…·ï¼‰
   - è®°å½•å½“å‰ä»·æ ¼

2. **è§¦å‘å¸‚åœºäº‹ä»¶**
   - å¤šæ¬¡æ¢åœ°ç‚¹
   - ç­‰å¾…å¸‚åœºäº‹ä»¶è§¦å‘
   - è§‚å¯Ÿé€šçŸ¥ä¸­çš„ä»·æ ¼å˜åŒ–

3. **éªŒè¯ä»·æ ¼è°ƒæ•´**
   - æ£€æŸ¥å¸‚åœºé¢æ¿ä¸­çš„ä»·æ ¼
   - ç¡®è®¤ä»·æ ¼å·²æŒ‰å€æ•°è°ƒæ•´
   - éªŒè¯ä»“åº“ä¸­çš„ç›ˆäºè®¡ç®—

4. **æµ‹è¯•äº‹ä»¶æŒç»­**
   - è§¦å‘äº‹ä»¶åŽä¸æ¢åœ°ç‚¹
   - éªŒè¯ä»·æ ¼ä¿æŒè°ƒæ•´åŽçš„å€¼
   - æ¢åœ°ç‚¹åŽéªŒè¯ä»·æ ¼é‡æ–°ç”Ÿæˆ

### é¢„æœŸç»“æžœ

- âœ… å¸‚åœºäº‹ä»¶è§¦å‘æ—¶æ˜¾ç¤ºé€šçŸ¥
- âœ… é€šçŸ¥åŒ…å«å•†å“åå’Œä»·æ ¼å˜åŒ–
- âœ… å¸‚åœºé¢æ¿ä»·æ ¼ç«‹å³æ›´æ–°
- âœ… ä»“åº“ç›ˆäºè®¡ç®—æ­£ç¡®
- âœ… ä¸‹ä¸€å¤©ä»·æ ¼é‡æ–°ç”Ÿæˆ

---

## ðŸš€ åŽç»­ä¼˜åŒ–å»ºè®®

### 1. å®žçŽ°èµ é€å•†å“äº‹ä»¶
å‚è€ƒåŽŸç‰ˆçš„4ä¸ªèµ é€äº‹ä»¶ï¼š
- åŽ¦é—¨è€åŒå­¦èµ„åŠ©èµ°ç§æ±½è½¦
- å·¥å•†å±€æ‰«è¡åŽæ¡åˆ°é¦™çƒŸ
- è€ä¹¡èµ é€å‡ç™½é…’
- æ‘é•¿å–æ°´è´§æ‰‹æœº

### 2. ä¼˜åŒ–è§¦å‘æœºåˆ¶
- è€ƒè™‘åœ¨æ¢åœ°ç‚¹æ—¶ä¹Ÿè§¦å‘äº‹ä»¶ï¼ˆæ›´ç¬¦åˆåŽŸç‰ˆï¼‰
- è°ƒæ•´è§¦å‘æ¦‚çŽ‡å…¬å¼æ›´æŽ¥è¿‘åŽŸç‰ˆ

### 3. å¢žå¼ºè§†è§‰åé¦ˆ
- ä»·æ ¼å˜åŒ–æ—¶æ·»åŠ åŠ¨ç”»æ•ˆæžœ
- åœ¨å¸‚åœºé¢æ¿ä¸­æ ‡è®°å—å½±å“çš„å•†å“
- æ·»åŠ ä»·æ ¼åŽ†å²å›¾è¡¨

### 4. äº‹ä»¶é“¾ç³»ç»Ÿ
- æŸäº›äº‹ä»¶å¯èƒ½è§¦å‘åŽç»­äº‹ä»¶
- æ·»åŠ äº‹ä»¶ç»„åˆæ•ˆæžœ
- å®žçŽ°å¤šå•†å“åŒæ—¶å—å½±å“

---

## ðŸ“ æŠ€æœ¯ç»†èŠ‚

### ä»·æ ¼è°ƒæ•´å…¬å¼

```javascript
newPrice = Math.floor(currentPrice * priceMultiplier)
```

- ä½¿ç”¨ `Math.floor` å‘ä¸‹å–æ•´ï¼ˆä¸ŽåŽŸç‰ˆä¸€è‡´ï¼‰
- `priceMultiplier > 1`ï¼šä»·æ ¼æš´æ¶¨
- `priceMultiplier < 1`ï¼šä»·æ ¼æš´è·Œ

### äº‹ä»¶æ•°æ®ç»“æž„

```javascript
{
    type: 'market',           // äº‹ä»¶ç±»åž‹
    msg: 'äº‹ä»¶æè¿°',          // æ˜¾ç¤ºæ¶ˆæ¯
    goodId: 5,                // å—å½±å“å•†å“ID (0-7)
    priceMultiplier: 2.0,     // ä»·æ ¼å€æ•°
    frequency: 170            // è§¦å‘é¢‘çŽ‡ï¼ˆè¶Šå¤§è¶Šå®¹æ˜“è§¦å‘ï¼‰
}
```

### è§¦å‘æ¦‚çŽ‡è®¡ç®—

åŽŸç‰ˆå…¬å¼ï¼š`RandomNum(950) % frequency == 0`

è¿‘ä¼¼æ¦‚çŽ‡ï¼š`frequency / 950`

ä¾‹å¦‚ï¼š
- frequency = 170 â†’ çº¦17.9%è§¦å‘æ¦‚çŽ‡
- frequency = 17 â†’ çº¦1.8%è§¦å‘æ¦‚çŽ‡

---

## ðŸ“¦ æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶
- âœ… `js/data.js` - ä¿®æ­£äº‹ä»¶æ•°æ®ï¼Œæ·»åŠ 11ä¸ªå¸‚åœºäº‹ä»¶
- âœ… `js/game-state.js` - å®žçŽ°ä»·æ ¼è°ƒæ•´é€»è¾‘
- âœ… `index.html` - æ›´æ–°ç‰ˆæœ¬å·

### æœªä¿®æ”¹çš„æ–‡ä»¶
- `js/game-controller.js` - æ— éœ€ä¿®æ”¹
- `style.css` - æ— éœ€ä¿®æ”¹
- `js/utils.js` - æ— éœ€ä¿®æ”¹

---

## âœ¨ æ€»ç»“

æˆåŠŸä¿®å¤äº†å¸‚åœºä»·æ ¼äº‹ä»¶ç³»ç»Ÿï¼Œå®žçŽ°äº†åŽŸç‰ˆçš„æ ¸å¿ƒä»·æ ¼è°ƒæ•´æœºåˆ¶ã€‚çŽ°åœ¨çŽ©å®¶å¯ä»¥ï¼š

1. ðŸŽ¯ **åˆ©ç”¨å¸‚åœºæ³¢åŠ¨**ï¼šåœ¨ä»·æ ¼æš´è·Œæ—¶ä¹°å…¥ï¼Œæš´æ¶¨æ—¶å–å‡º
2. ðŸ“ˆ **æŸ¥çœ‹ä»·æ ¼å˜åŒ–**ï¼šé€šçŸ¥ä¸­æ˜¾ç¤ºè¯¦ç»†çš„ä»·æ ¼å˜åŒ–
3. ðŸŽ² **ä½“éªŒéšæœºæ€§**ï¼šæ¯æ¬¡æ¸¸æˆçš„å¸‚åœºäº‹ä»¶éƒ½ä¸åŒ
4. ðŸ’° **å¢žåŠ æ”¶ç›Š**ï¼šé€šè¿‡æŠŠæ¡å¸‚åœºæ—¶æœºèŽ·å¾—æ›´é«˜åˆ©æ¶¦

è¿™å¤§å¹…æå‡äº†æ¸¸æˆçš„ç­–ç•¥æ€§å’Œå¯çŽ©æ€§ï¼Œä½¿å…¶æ›´æŽ¥è¿‘åŽŸç‰ˆçš„æ¸¸æˆä½“éªŒï¼

---

**ä¿®å¤æ—¶é—´**: 2025-12-29  
**ç‰ˆæœ¬**: v1.3 - Market Price Events System  
**å‚è€ƒæ–‡æ¡£**: `PRICE_EVENT_ANALYSIS.md`
